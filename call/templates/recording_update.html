{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
<meta name="description" content="Smarthr - Bootstrap Admin Template">
<meta name="keywords" content="admin, estimates, bootstrap, business, corporate, creative, management, minimal, modern, accounts, invoice, html5, responsive, CRM, Projects">
<meta name="author" content="Dreamguys - Bootstrap Admin Template">
<meta name="robots" content="noindex, nofollow">
<title>Video Call - HRMS admin template</title> 
<link rel="shortcut icon" type="image/x-icon" href="smarthr-laravel/html-template/light/assets/img/favicon.png">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.agora.io/sdk/release/AgoraRTCSDK-3.5.2.js"></script>
<link rel="stylesheet" href="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/css/font-awesome.min.css' %}">
<link rel="stylesheet" href="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/css/line-awesome.min.css' %}">
<link rel="stylesheet" href="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/css/style.css' %}">
</head>
<body id='body_div'>
	<div class="time_stamp">
		<span class="call-duration" id="demo" style="top: -60px;width: max-content;left: -300px;">Clock</span>
		
		<span class="call-duration" id="chance" style="top: -60px;width: max-content;left: -200px;">Chance</span>
	</div>
	<div class="courses" style="border: 4px solid rgba(0, 0, 0, 0.3);background-color: rgba(87, 87, 87, 0.4);">
		{% for i in skills %}
		<h5 id="skill{{forloop.counter0}}" style="text-transform: uppercase;color:white; background-color: black">{{i}}</h5>
		{% endfor %}
	</div>
	<div>
	<div class="designation1"  style="top: -280px;left: 100px;width: max-content; background-color: black; color:white"><h3>{{meet.prof.user.first_name}}</h3></div>
	<div class="designation1"  style="top: -280px;left: 100px;width: max-content; background-color: black; color:white" ><h3>({{meet.prof.designation}})</h3></div>
	</div>
<div>
	<div class="designation2" style="top: -340px;left: 600px;width: max-content; background-color: black; color:white"><h3>{{meet.fresher.user.first_name}}</h3></div>
	<div class="designation2" style="top: -340px;left: 600px;width: max-content; background-color: black; color:white"><h3>({{meet.designation}})</h3></div>
	
</div>
	<!-- <div class="visiting_card" id="image-background" style="font-size: 25px;color: black;background-image: url('https://www.mandlpaints.com/wp-content/uploads/2018/09/Pearl-Grey-300x300.jpg');background-size: 100%;">
		<a href="www.classfly.in" >www.classfly.in</a><br>
		<h7>PreInterviewed Job Portal</h7>
	</div> -->
<!-- text-shadow: 0 0 2px #000; -->
	<div class="main-wrapper">
<div class="header">
<div class="header-left">
<a href="#" class="logo" style="margin-left: -160px;color:#4266f5; text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;">
<h1><img src="{% static 'recording/classfly-record.png' %}" width="40" height="40" alt=""><b>CLASSFLY</b>
</h1></a>

</div>
<div class="page-title-box">
<h3>ClassFly</h3>
</div>

<div class="page-wrapper">
<div class="chat-main-row">
<div class="chat-main-wrapper">
<div class="col-lg-9 message-view task-view" >
<div class="chat-window" >
<div class="chat-contents"  id="chatwindow">
<div class="chat-content-wrap">
	<div>
<div class="my-video" id="remote-playerlist">
		
</div>
<div class="my-video" id="fresher_video">

</div>
</div>
</div>
</div>
</div>
</div>
<div class="col-lg-3 message-view chat-profile-view chat-sidebar" id="task_window">
<div class="chat-window video-window">
<div class="fixed-header">
<ul class="nav nav-tabs nav-tabs-bottom">
<li class="nav-item"><a class="nav-link" href="#chats_tab" data-toggle="tab">Chats</a></li>
</ul>
</div>
<div class="content-full tab-pane" id="chats_tab">
	<div class="chat-window" id ="window">
	<div class="chat-contents">
	<div class="chat-content-wrap">
	<div class="chat-wrap-inner">
	<div class="chat-box" style="overflow: scroll;height: 550px;" id="chatdiv">
	<div class="chats" id="chatbox">
	
	

	</div>
	</div>
	</div>
	</div>
	</div>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script data-cfasync="false" src="{% static 'recording/Videocall/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js' %}"></script>
<script src="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/js/jquery-3.5.1.min.js' %}"></script>
<script src="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/js/popper.min.js' %}"></script>
<script src="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/js/bootstrap.min.js' %}"></script>
<script src="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/js/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'recording/Videocall/smarthr-laravel/html-template/light/assets/js/app.js' %}"></script>
<script>

 
	var option = {
		appid: '{{appid}}',
		channel: '{{channel}}',
		uid: '{{uid}}',
		token: '{{token}}'
	};

	

	//variable for meeting status

	var aid = '{{aid}}'
	var mid = '{{mid}}'
	var pfmid = '{{pfmid}}'
	var pro_uid = '{{pro_uid}}'
	var fresh_uid = '{{fresh_uid}}'
	var record_uid = '{{record_uid}}';

	// console.log(option);

	//function for agora to know the page is loaded
	function notifyReady() {
			if (typeof window.navigator.notifyReady === 'function')
			window.navigator.notifyReady();
	}
	


	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script><!-- <script src="../assets/bootstrap.bundle.min.js"></script> -->
	<script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>

	<!-- <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.5.0.js"></script> -->

	<script src="{% static 'recording/record.js' %}"></script>

	<script>
	document.getElementById('chatwindow').style['background-image'] = 'url("https://classfly.s3.ap-south-1.amazonaws.com/recordbackground.png")';
	document.getElementById('chatwindow').style['display'] = 'revert';
	document.getElementById('chatwindow').style['margin-left'] = "-380px";
	document.getElementById('chatwindow').style['margin-top'] = '-50px';
	
	</script>


<!-- 
	<div id="player-wrapper-8651765" style="width:100%; height:100%">
        <div id="player-8651765" class="player" style="width:600px; height:350px"><div id="agora-video-player-track-video-8651765" style="width: 100%; height: 100%; position: relative; overflow: hidden; background-color: silver;"><video id="video_track-video-8651765" class="agora_video_player" style="width: 100%; height: 100%; position: relative; left: 0px; top: 0px; object-fit: revert;" playsinline="" muted=""></video></div></div>
      </div>
 -->
 <!-- code to work with highlighting topics based on time -->
<script>

var skills = '{{meet.skills}}'.split(',');
var total_seconds = (skills.length * 600) + 1;
var temp_seconds = 0;
var time = "";
var past_id = 0; 
var id  = 0;
window.setInterval(update, 1000);

function update(){
  // setInterval(update, 1000);
  id = skills.length - parseInt(total_seconds / 600 ) - 1;
  total_seconds -= 1;
  if (total_seconds > 0){
    // total_seconds = total_seconds-1;
    minutes = parseInt( ( total_seconds - (skills.length-id - 1) * 600) / 60, 10);  
    seconds = parseInt(( total_seconds - (skills.length-id - 1) * 600) % 60, 10);  
	
	console.log(total_seconds,(skills.length-id - 1),( total_seconds - (skills.length-id - 1) * 600))
	
	minutes = minutes < 10 ? "0" + minutes : minutes; 
    seconds = seconds < 10 ? "0" + seconds : seconds; 
    time = minutes + ":" + seconds ;  
    document.getElementById("skill"+id).innerHTML = skills[id] + ":"+time;
	console.log('id',id,'pastid',past_id);
	console.log('before',tmp); 
	
    if(id > 0 && id != past_id){
	
      var tmp = past_id;
      past_id = id ;
      while(tmp >= 0)
    	{
		document.getElementById("skill"+tmp).innerHTML=skills[tmp] ;
		document.getElementById("skill"+tmp).style.color = "rgba(189, 189, 255)";
		tmp -= 1;  
    	}
    } 
  }
  else{
    document.getElementById("skill"+id).innerHTML=skills[id] ;
      document.getElementById("skill"+id).style.color = "rgba(237, 237, 255)";
      
  }
  
}
 
 </script>


<script>

	var fresher_image_src = '';
	var prof_image_src = '';
	
	//variable for professional
	var user = '{{user}}' ;
	
	var oppo_user_name = '{{meet.prof.user.first_name}}';
	var oppo_user_id = '{{meet.prof.user.id}}';
	var user_name ='{{meet.fresher.user.first_name}}'
	var user_id = '{{meet.fresher.user.id}}'
	const roomName =  '{{chat_room_name}}';
        

	 $(document).ready(async function(){

 {% if meet.prof.profile_pic != '' %}
       
  // Note the await keyword

  
    await fetch("{{meet.prof.profile_pic}}")
    .then((response) => response.text())
    .then((result) => {
        prof_image_src = result;
    })
    .catch((error) => console.log("error", error));

    
    {% endif %}

    {% if meet.fresher.profile_pic != '' %}

    await fetch("{{meet.fresher.profile_pic}}")
    .then((response) => response.text())
    .then((result) => {
        fresher_image_src = result;
    })
    .catch((error) => console.log("error", error));
    // 
    

    {% endif %}


    $("img[id*='profpic']").attr({src:prof_image_src});
    
    $("img[id*='fresherpic']").attr({src:fresher_image_src});
    
    

    }); //end of jquery code



	         function received(data)
        {
            // console.log(data, user_id);
			var chat_content = '<div class="chat chat-left">'
			+'<div class="chat-avatar">'
			+'<a href="#" class="avatar">'
			
			if('{{meet.prof.user.id}}' == data.user )
			{
				chat_content += '<img alt="" src="' + prof_image_src + '" >';
			}
			else if('{{meet.fresher.user.id}}' == data.user){
				chat_content += '<img alt="" src="' + fresher_image_src + '" >';
			} 

			chat_content += '</a></div><div class="chat-body"><div class="chat-bubble"><div class="chat-content"><span class="task-chat-user">';

			// <!-- check which user has sent the message -->
			if (data.user == oppo_user_id)
			{
				console.log('oppo user',oppo_user_id,oppo_user_name)
				chat_content +=  oppo_user_name ;
			}
			else if(data.user == user_id)
			{
				console.log('xxxxxxxxxxxx',user_id,user_name)
				chat_content += user_name;
			}
			chat_content += '</span> <span class="chat-time">' + data.time + '</span><pre>' + data.message + '</pre></div></div></div></div>'
			document.getElementById("chatbox").innerHTML += chat_content;

			

			// code for auto scroll when a new message is added.
			var element = document.getElementById("chatdiv");
			element.scrollTop = element.scrollHeight - element.clientHeight;
			
        }



        var wss_protocol = (window.location.protocol == 'https:') ? 'wss://': 'ws://';
        
        const chatSocket = new WebSocket(
            wss_protocol 
            + window.location.host
            + '/ws/chat/'
            + roomName
            + '/'
        );

// <!-- Code to recive message from others -->
        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            //if the type is chatting message
            if (data.type == 'meet_message')
                {
                received(data);
                }
            else{
				console.log(data);
			}
		};
		
		chatSocket.onclose = function(e) {
			// alert('Chatting Disconnected');
            console.error('Chat socket closed unexpectedly');
		};
		


</script>


</html>